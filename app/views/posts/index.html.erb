<%# http://localhost:3000/posts %>
<%#= posts_path %>
<%= link_to "New post", new_post_path, class: "btn btn-primary" %>

<br>
<br>
<br>

<% @posts.each do |post| %>
<!-- post card -->
  <div class="flex bg-white shadow-lg rounded-lg  card-post mb-5" ><!--horizantil margin is just for display-->
    <div class="flex items-start px-4 py-6 w-100 " id="post-<%=post.id %>">
      <%= cl_image_tag post.photo.key, height: 300, width: 400, crop: :fill %>
      <div>
      <div class="pl-5 mt-3" style="margin-left: 3.25rem;">
        <% if post.user.id == current_user.id %>
        <div class="bg-gray-200 my-artwork px-3 py-1 mb-3 rounded-full text-xs font-medium text-gray-800 hidden md:block" style="position: relative; left: 0px">
          My Artwork</div>
        <% end %>
          <div class="flex items-center justify-between w-100">
            <div>
              <% if current_user.photo.attached? %>
                <%= cl_image_tag current_user.photo.key, class: "avatar dropdown-toggle", id: "navbarDropdown", data: {bs_toggle: "dropdown"}, aria: {haspopup: "true", expanded: "false"} %>
              <% else %>
                <img class="avatar dropdown-toggle" id="navbarDropdown" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false" src="https://raw.githubusercontent.com/lewagon/fullstack-images/master/uikit/logo.png" />
              <% end %>
            </div>
            <div class="ml-5">
              <h2 class="text-lg font-semibold text-gray-900 -mt-1"><%= post.author %> </h2>
              <small class="text-sm text-gray-700">Published In: <%= post.created_at.strftime("%d/%M/%Y")%></small>
            </div>
            <small class="text-gray-700" style="align-self: flex-start;">Joined: <%= post.user.created_at.strftime("%A, %d %b %Y")%> </small>
          </div>

          <p class="mt-3 text-gray-700 text-sm">
            <%= post.description %>
          </p>

          <div class="mt-4 flex items-left flex-column">
            <div>
              <%= link_to "View Art", post_path(post), class: "card-link btn btn-secondary" %>
              <% if post.user_id == current_user.id %>
                <%= link_to "Delete", post, method: :delete, data: { confirm: "Are you sure?" }, class: "card-link btn btn-danger" %>
                <%= link_to "Edit", edit_post_path(post), class: "card-link btn btn-warning" %>
              <% end %>
            </div>
            <%= render "comments/form", comment: @comment%>
            <div class="mt-3">
            <div class="flex mr-2 text-gray-700 text-sm mr-3 mb-2">
            <% if  current_user.likes.where(post: post).count.zero? %>
              <%=link_to post_likes_path(post), remote: true, method: :post do%>
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1 text-pink-500" viewBox="0 0 20 20"
                fill="lightgrey">
                <path fill-rule="evenodd"
                  d="M3.172 5.172a4 4 0 015.656 0L10 6.343l1.172-1.171a4 4 0 115.656 5.656L10 17.657l-6.828-6.829a4 4 0 010-5.656z"
                  clip-rule="evenodd" />
              </svg>
              <% end %>
            <% else %>
              <%= link_to like_path(post.id), method: :delete,  remote: true do%>
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1 text-pink-500" viewBox="0 0 20 20"
                fill="currentColor">
                <path fill-rule="evenodd"
                  d="M3.172 5.172a4 4 0 015.656 0L10 6.343l1.172-1.171a4 4 0 115.656 5.656L10 17.657l-6.828-6.829a4 4 0 010-5.656z"
                  clip-rule="evenodd" />
              </svg>
              <% end %>
            <% end %>
                <span class="me-3"> <%=post.likes.count %></span>
            </div>
            <div class="flex mr-2 text-gray-700 text-sm mr-8 mb-2">
                <svg fill="none" viewBox="0 0 24 24" class="w-4 h-4 mr-1" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8h2a2 2 0 012 2v6a2 2 0 01-2 2h-2v4l-4-4H9a1.994 1.994 0 01-1.414-.586m0 0L11 14h4a2 2 0 002-2V6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2v4l.586-.586z"/>
                </svg>
                <span><%= post.comments.count %> <%= link_to "Comments", post_path(post) %></span>
            </div>
            <div class="flex mr-2 text-gray-700 text-sm mr-4 mb-2">
                <svg fill="none" viewBox="0 0 24 24" class="w-4 h-4 mr-1" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"/>
                </svg>
                <span>Share</span>
            </div>
            </div>
          </div>
      </div>
      </div>
    </div>
  </div>
<% end %>
